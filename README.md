# ClinicalVolumes-medical-imaging-software

## Abstract
Background: Modern medical imaging relies on the accurate and rapid image analysis due to the large size of datasets collected on a daily basis both in clinical and pre-clinical imaging, for diagnosis, treatment planning, and research purposes. In order to improve the technology behind such requirements, here we introduce a new image analysis software called ClinicalVolumes. ClinicalVolumes is a semi-automatic image volume analysis tool based on a clustering signal intensity threshold-based method. It has been developed in C++ and can run on both Windows and Mac OS X operating systems. The program is currently available for research use only at https://www.kaggle.com/datasets/prot78/clinicalvolumes. 

Results: ClinicalVolumes has been validated with several MRI applications but it also can process Echocardiography and CT images. MRI datasets of clinical cardiac cases, and pre-clinical mouse models of heart, brain and adipose tissues have been analyzed by the ClinicalVolumes software and results were compared to a full manual segmentation. Bland-Altman analysis, intra- and inter-observer variability are reported for all investigated MRI applications as a numeric validation. The accuracy error was estimated to be below 10% and the segmentation was from 2 to 4 times faster, depending on the application, when compared to a full manual segmentation.

Conclusions: ClinicalVolumes is a fast, robust, user-friendly and accurate tool for image segmentation aimed to improve volume analysis in numerous medical applications ranging from cardiovascular disease to tumor and brain imaging.           

Keywords: segmentation; volumes; MRI; Echocardiography; CT; clinical; pre-clinical; DICOM.


## Background
Image segmentation plays a central rule in the increasing number of multidimensional and multimodality datasets generated by digital imaging techniques [1, 2]. The medical field, in particular, relies on computer programs to study the large amount of data collected by medical equipment, such as Magnetic Resonance Imaging (MRI), Echocardiography or Computer Tomography (CT), in order to improve diagnosis or determine appropriate treatment [3]. The progression towards automated or semi-automated segmentation software, which can provide accurate results in a shortened analysis time, is therefore of critical interest [4].

Tissue volume analysis such as that of heart [5], brain [6], cancer [7], vascular tissues, bones, or adipose tissues [8], provides a powerful tool to investigate functional and volumetric parameters. In cardiac studies, for instance, ejection fraction (EF), left ventricle end-diastolic volume (LVEDV) and left ventricle end-systolic volume (LVESV), are essential parameters to determine the conditions of the organ and the health status of the patient. An accurate and reliable segmentation of the left ventricle (LV) is therefore of great clinical and pre-clinical interest. The same applies to all medical imaging fields where accurate and reliable segmentations can result in useful diagnostic information so as to help target treatments. 

Recent years have seen a rapid evolution of medical image analysis software [4, 9-11]. However a large number of those are specifically designed to investigate single organs rather than providing a means for broader applications. The software here introduced, named ClinicalVolumes, was validated on MR volumes but has the potential to also analyze images from other medical imaging modalities including echocardiography, computed tomography (CT) or positron emission tomography (PET) in addition to be a specific application software. ClinicalVolumes is able to reduce analysis time with respect to a full manual segmentation by using an efficient clustering threshold-based technique to limit areas of interest and also by a rich set of user-friendly graphical-editing capabilities. The software exploits an automatic segmentation together with a user-friendly manual image optimization approach thus making ClinicalVolumes a valuable semi-automated program. 

The accuracy and efficiency of the new software has been evaluated for several MRI applications and the results are here reported. The tool is routinely used to perform cardiovascular MRI image analysis in our laboratories, thereby providing valuable diagnostic information for pre-clinical studies in murine models of cardiac diseases [12]. 


Method
The design, implementation, medical applications and validation of the software are described in this section.
A. Design
A.1. Overview
ClinicalVolumes is a volumetric analysis software relying on an efficient clustering threshold-based technique to limit areas of interest in a semi-automated way. The software is intended to process images or image stacks (a single image (2D), a time-resolved single image (2D+T), a stack of images representing a multi-slice image volume (3D) or a time-resolved multi-slice image volume (3D+T)).
The software loads and stores data in DICOM format, the standard format for handling, storing, printing, and transmitting information in medical imaging. Single volumes are typically uploaded and analyzed. This operation itself neglects the use of very large datasets of the order of Gigabytes (single medical volumes are usually smaller than 1Gb) which could exceed the computer RAM, used for I\O, thus sensibly affecting the analysis time.
When working with 3D+T images, the data is visualized and processed in four main modalities, which can be selected by the user: single-frame, single-slice, multiple-frames and multiple-slices.
The image analysis is achieved by segmenting the areas of interest with a threshold-based technique: a set of connected pixels, called “cluster”, with Signal Intensities (SI) contained within a user-selected intensity window can be generated in an area of interest. The cluster can be propagated through the volume making left ventricular endocardial border detection a trivial task. For accuracy purposes the cluster can be locally improved whenever the region of interest becomes inadequate. This can be carried out by manually modifying the cluster; mouse-based editing capabilities serve this purpose. ClinicalVolumes can also generate multiple clusters in different areas simultaneously. All the editing options are accessed with the mouse. 
The software also enables the employment of a series of options during the segmentation process. With a single mouse click, the aforementioned cluster can be expanded to any frame or slice. Single or multiple slices can be selected to be included or excluded by the segmentation activities. Commands such as global and selective zoom, contrast adjustment, ROIs for signal intensity histogram, sector and spline-based analysis have been successfully integrated. All the features provide a user-friendly approach to the program.  
A.2. Clustering algorithm
ClinicalVolumes segments volumes by generating a cluster from a user-selected image position that is then propagated to nearby pixels. The cluster expands through those image pixels whose signal intensity falls into a user-selected intensity window. The clustering algorithm uses the following inputs:
(a) the intensity of each pixel of the slice to operate on; 
(b) the buffer that stores the editing color for each such pixel, called `color buffer'; 
(c) the currently selected editing mode and color; 
(d) the coordinates of the selected pixel in (a) from which the clusterization is started; 
(e) the function that  determines what is the action to undertake on a currently processed pixel given its intensity, its color (if any) and its mode and color. 
Furthermore, the clustering relies on a graph growing propagation scheme based on the usage of temporary buffers which register and exchange input information. 
The clustering algorithm was implemented as followed. Firstly, the current editing color is written in the color buffer at the position indicated by the coordinates of the selected pixel (d) (step 1). The coordinates of the selected pixel are registered in the first temporary buffer (step 2). The eight neighbor pixel of the mouse-pointed pixel are examined. The neighbor pixels are (re)colored, if deemed so according to (e), and their coordinates are written in the second temporary buffers (step 3). The two temporary buffers are than swapped and the number of non-empty elements of the first temporary buffer is zeroed (step 4). Steps 3) and 4) are repeated for each pixel indicated by the first temporary buffer, instead of the mouse-pointed pixel - as specified in (step 3) - until this buffer is empty.
The clustering algorithm operates sequentially on multiple image slices or on  the current one only, depending on the editing mode decided by the user. For a  specific slice, the algorithm takes as input: 
(a) the coordinates of the slice pixel  defined by the mouse and the current screen-to-slice mapping parameters, 
(b) the  pixel intensities of the image slice, 
(c) the buffer that registers the colors of the  pixels of that slice, 
(d) the editing color currently selected by the user and 
(e) a  function which determine what to do at a  pixel position having as input its intensity (from (b)), the registered color (if any,  from (c)) and the user-selected editing color (i.e. (d)).   
The clustering algorithm relies on a graph growing propagation scheme and is here described in more detail. If the function which determines what to do at a  pixel position decides that the mouse-selected pixel should not be (re)colored, the clustering does not start, otherwise the color buffer is locally modified and the coordinates of the above pixels are registered in a temporary buffer. Then, if the temporary buffer is full, the propagation scheme proceeds by examining the content of the elements of the image slice and of the color buffer corresponding to the eight pixels that are adjacent to the mouse-selected pixel. Consequently, the clustering process employs the function which determines what to do at a  pixel position to operate as for the first pixel and registers the pixel coordinates of the (re)labeled color buffer elements in a second temporary buffer. In the successive step, if the latter is empty the procedure ends, otherwise the two temporary stacks are swapped, the number of filled elements of the second temporary buffer is zeroed and the clustering process continues as before. As such, this terminates whenever an algorithmic step does not label any element of the color buffer. 
This clustering scheme is of recursive nature because from a parent pixel multiple adjacent pixels are considered and each of these, in turn, may trigger the inspection of many other pixels, thereby eventually producing an exponential increase of work. Noteworthy, the presently described version is iterative, which enhances processing performance with respect to a recursive version relying on the slow management of temporary stacks automatically carried out by the current programming environment.


![hello](images/Fig1.PNG).
